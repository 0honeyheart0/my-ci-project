# –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –†–ê–ë–û–ß–ò–ô –ö–û–ù–§–ò–ì –¥–ª—è –Ω–∞—á–∞–ª–∞

# 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞–¥–∏–∏ (—ç—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
stages:
  - validate   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
  - test       # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
  - deploy     # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

# 2. –ü–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ bash
validate-bash:
  stage: validate
  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–≥–∫–∏–π –æ–±—Ä–∞–∑ Alpine
  image: alpine:latest
  script:
    - echo "üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É bash —Å–∫—Ä–∏–ø—Ç–æ–≤..."
    - apk add --no-cache bash shellcheck
    - shellcheck scripts/*.sh || echo "‚ö†Ô∏è  –ï—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è"

# 3. –í—Ç–æ—Ä–æ–µ –∑–∞–¥–∞–Ω–∏–µ: Python —Ç–µ—Å—Ç—ã
test-python:
  stage: test
  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python –æ–±—Ä–∞–∑
  image: python:3.11-alpine
  script:
    - echo "üß™ –ó–∞–ø—É—Å–∫–∞–µ–º Python —Ç–µ—Å—Ç—ã..."
    - pip install pytest
    - python -c "import pytest; pytest.main(['-v', 'test_app.py'])"

# 4. –¢—Ä–µ—Ç—å–µ –∑–∞–¥–∞–Ω–∏–µ: –∑–∞–ø—É—Å–∫ –Ω–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
run-script:
  stage: test
  image: alpine:latest
  script:
    - echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç..."
    - apk add --no-cache bash
    - ./scripts/hello.sh

# 5. –î–µ–º–æ-–¥–µ–ø–ª–æ–π (–∏–º–∏—Ç–∞—Ü–∏—è)
deploy-demo:
  stage: deploy
  image: alpine:latest
  script:
    - echo "üöÄ –î–ï–ü–õ–û–ô!"
    - echo "–ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."
    - echo "–î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω! üéâ"
  only:
    - main  # –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—à–µ –≤ main –≤–µ—Ç–∫—É
