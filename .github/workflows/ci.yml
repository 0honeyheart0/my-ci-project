name: Simple CI

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿Ñ€Ð¸ Ð¿ÑƒÑˆÐµ Ð¸ Ð¿Ñ€Ð¸ pull request
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Ð¢ÐžÐ›Ð¬ÐšÐž ÐžÐ”ÐÐ Ð—ÐÐ”ÐÐ§Ð - Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
  test:
    name: ðŸ§ª Run Tests
    runs-on: ubuntu-latest
    
    steps:
    # 1. ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð´
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    # 2. Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Python
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    # 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾ ÐµÑÑ‚ÑŒ Ñ„Ð°Ð¹Ð»Ñ‹
    - name: ðŸ“ List files
      run: |
        echo "ðŸ“‚ Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ:"
        ls -la
        echo ""
        echo "ðŸ“„ Python Ñ„Ð°Ð¹Ð»Ñ‹:"
        ls *.py 2>/dev/null || echo "ÐÐµÑ‚ Python Ñ„Ð°Ð¹Ð»Ð¾Ð²"
    
    # 4. Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
    - name: ðŸ“¦ Install dependencies
      run: |
        if [ -f requirements.txt ]; then
          echo "Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¸Ð· requirements.txt"
          pip install -r requirements.txt
        else
          echo "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ requirements.txt Ñ pytest"
          echo "pytest==7.4.3" > requirements.txt
          pip install pytest
        fi
    
    # 5. Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹
    - name: âœ… Run Simple Tests
      run: |
        echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Python ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ..."
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²ÑÐµ .py Ñ„Ð°Ð¹Ð»Ñ‹
        for file in *.py; do
          if [ -f "$file" ]; then
            python -m py_compile "$file" && echo "âœ… $file: ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚ÐµÐ½"
          fi
        done
        
        echo ""
        echo "ðŸ§ª Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ñ‹..."
        
        # Ð•ÑÐ»Ð¸ ÐµÑÑ‚ÑŒ test_app.py - Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼
        if [ -f test_app.py ]; then
          echo "Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ test_app.py"
          python test_app.py
        fi
        
        # Ð•ÑÐ»Ð¸ ÐµÑÑ‚ÑŒ calculator.py - Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼
        if [ -f calculator.py ]; then
          echo "Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ calculator.py"
          python calculator.py
        fi
        
        # Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ Ñ‚ÐµÑÑ‚Ð¾Ð² - ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹
        if [ ! -f test_app.py ] && [ ! -f calculator.py ]; then
          echo "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ‚ÐµÑÑ‚..."
          cat > simple_test.py << 'TESTEOF'
def test_basic():
    assert 1 + 1 == 2, "1+1 Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 2"
    print("âœ… Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½")

if __name__ == "__main__":
    test_basic()
    print("ðŸŽ‰ Ð’ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹!")
TESTEOF
          python simple_test.py
        fi
    
    # 6. Ð’ÑÐµÐ³Ð´Ð° Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
    - name: ðŸ“Š Show Result
      if: always()
      run: |
        echo ""
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘      CI PIPELINE RESULTS     â•‘"
        echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
        echo "â•‘ Repository: ${{ github.repository }}"
        echo "â•‘ Branch: ${{ github.ref }}"
        echo "â•‘ Commit: ${{ github.sha }}"
        echo "â•‘ Run ID: ${{ github.run_id }}"
        echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
        
        if [ "${{ job.status }}" = "success" ]; then
          echo "â•‘ Status: âœ… SUCCESS           â•‘"
          echo "â•‘                              â•‘"
          echo "â•‘ Ð’ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹!         â•‘"
        else
          echo "â•‘ Status: âŒ FAILURE           â•‘"
          echo "â•‘                              â•‘"
          echo "â•‘ Ð•ÑÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² Ñ‚ÐµÑÑ‚Ð°Ñ…        â•‘"
        fi
        
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
