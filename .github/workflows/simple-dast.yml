name: Simple DAST

on: [push, workflow_dispatch]

jobs:
  dast-simple:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: üê≥ Start application
      run: |
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        docker-compose up -d
        echo "Waiting for app..."
        sleep 15
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
        curl -f http://localhost:5000 && echo "‚úÖ App is running"
    
    - name: üîç Basic security checks
      run: |
        echo "Performing basic DAST checks..."
        echo "================================="
        
        # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        echo "1. Checking security headers..."
        curl -I http://localhost:5000 | grep -i "security\|x-" || echo "No security headers found"
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ SQL injection (–ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç)
        echo ""
        echo "2. Testing for SQL injection..."
        RESPONSE=$(curl -s "http://localhost:5000/api/add?a=1' OR '1'='1&b=1")
        if echo "$RESPONSE" | grep -q "error\|exception\|sql"; then
          echo "‚ùå Possible SQL injection vulnerability"
        else
          echo "‚úÖ SQL injection test passed"
        fi
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ XSS (–ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç)
        echo ""
        echo "3. Testing for XSS..."
        RESPONSE=$(curl -s "http://localhost:5000/api/add?a=<script>alert(1)</script>&b=1")
        if echo "$RESPONSE" | grep -q "<script>\|alert\|javascript"; then
          echo "‚ùå Possible XSS vulnerability"
        else
          echo "‚úÖ XSS test passed"
        fi
        
        # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ path traversal
        echo ""
        echo "4. Testing for path traversal..."
        curl -s "http://localhost:5000/../../etc/passwd" | head -1 | grep -q "root:" && echo "‚ùå Path traversal possible" || echo "‚úÖ Path traversal test passed"
        
        echo ""
        echo "================================="
        echo " Basic DAST checks completed"
    
    - name: Use wfuzz for fuzzing
      run: |
        echo "Installing wfuzz for endpoint discovery..."
        pip install wfuzz
        
        echo "Discovering endpoints..."
        wfuzz -c -z file,/usr/share/dict/words --hc 404 http://localhost:5000/FUZZ 2>/dev/null | head -20
        
        echo "Endpoint discovery completed"
    
    - name:  Cleanup
      if: always()
      run: docker-compose down
