name: Working DAST
on: push

jobs:
  dast:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ðŸ³ Setup Docker
      uses: docker/setup-buildx-action@v2
    
    - name: ðŸš€ Build and run with Docker
      run: |
        # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Docker Ð¾Ð±Ñ€Ð°Ð·
        docker build -t myapp .
        
        # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
        docker run -d -p 5000:5000 --name myapp-container myapp
        
        # Ð–Ð´ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÐºÐ°
        sleep 10
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼
        curl -s http://localhost:5000 && echo "âœ… App running in Docker"
    
    - name: ðŸ” Security test
      run: |
        # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ nmap
        sudo apt-get update
        sudo apt-get install -y nmap
        
        # Ð¡ÐºÐ°Ð½Ð¸Ñ€ÑƒÐµÐ¼
        echo "Scanning application..."
        nmap -sV -p 5000 localhost
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ endpoint'Ñ‹
        curl -s http://localhost:5000/api/add?a=5&b=3 | jq . 2>/dev/null || curl -s http://localhost:5000/api/add?a=5&b=3
    
    - name: ðŸ§¹ Cleanup
      if: always()
      run: |
        docker stop myapp-container 2>/dev/null || true
        docker rm myapp-container 2>/dev/null || true
